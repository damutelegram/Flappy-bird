<!doctype html>

<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Flappy Bird ‚Äî HTML5</title>
  <style>
    :root{
      --bg:#70c5ce;--ground:#ded895;--bird:#ffdd57;--pipe:#2ea44f;
      --menu-bg:linear-gradient(180deg,#9be2fe,#67d1fb);
      --btn-bg:linear-gradient(180deg,#ffdd57,#ffb347);
      --btn-hover:linear-gradient(180deg,#ffe87a,#ffc55b);
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:'Segoe UI',Roboto,Arial,sans-serif;}
    body{display:flex;align-items:center;justify-content:center;background:var(--bg);padding:12px;overflow:hidden;}
    .game-wrap{width:100%;max-width:480px;position:relative;}
    canvas{display:block;width:100%;height:auto;border-radius:1px;box-shadow:0 1px 1px rgba(15,30,40,0.18)}/* ===== –ú–µ–Ω—é ===== */
#menu{
  position:absolute;inset:0;display:flex;flex-direction:column;justify-content:center;align-items:center;
  background:var(--menu-bg);z-index:10;transition:opacity .6s ease,transform .6s ease;
}
#menu.hide{opacity:0;pointer-events:none;transform:scale(1.1);}
#menu h1{
  font-size:2.4rem;color:#045;text-shadow:0 3px 6px rgba(0,0,0,0.2);margin-bottom:1.2rem;
}
.menu-row{display:flex;gap:10px;margin-bottom:12px}
.menu-btn{
  background:var(--btn-bg);border:none;color:#222;font-weight:600;font-size:1.0rem;
  padding:10px 20px;margin:6px;border-radius:50px;cursor:pointer;box-shadow:0 6px 12px rgba(0,0,0,0.12);
  transition:transform .18s,box-shadow .18s,background .18s;
}
.menu-btn:hover{background:var(--btn-hover);transform:translateY(-2px);box-shadow:0 8px 18px rgba(0,0,0,0.16)}
.hint,.credits{text-align:center;color:#033;margin-top:8px;}
.credits{font-size:12px;color:rgba(0,0,0,0.45)}

/* small UI for music state */
.small{font-size:0.9rem;padding:8px 14px}

  </style>
</head>
<body>
  <div class="game-wrap">
    <canvas id="game"></canvas>
    <div id="menu">
      <h1>Flappy Bird</h1>
      <div class="menu-row">
        <button class="menu-btn" id="startBtn">–ò–≥—Ä–∞—Ç—å</button>
        <button class="menu-btn" id="helpBtn">–ü–æ–º–æ—â—å</button>
      </div>
      <div class="menu-row">
        <button class="menu-btn" id="recordsBtn">–†–µ–∫–æ—Ä–¥—ã</button>
        <button class="menu-btn small" id="musicBtn">üîä –ú—É–∑—ã–∫–∞: ‚Äî</button>
      </div>
    </div>
    <div class="hint">–ü—Ä–æ–±–µ–ª / —Ç–∞–ø ‚Äî –ª–µ—Ç–µ—Ç—å, R ‚Äî –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫</div>
    <div class="credits">–°–¥–µ–ª–∞–Ω–æ —Å ‚ù§Ô∏è ‚Äî –æ—Ç Parsival (https://t.me/oneminutesir)</div>
  </div><script>
(() => {
  // Canvas + UI elements
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  const menu = document.getElementById('menu');
  const startBtn = document.getElementById('startBtn');
  const helpBtn = document.getElementById('helpBtn');
  const recordsBtn = document.getElementById('recordsBtn');
  const musicBtn = document.getElementById('musicBtn');

  function resize() {
    const cssW = Math.min(480, window.innerWidth - 24);
    const cssH = Math.max(600, Math.round(cssW * (800/480)));
    canvas.style.width = cssW + 'px';
    canvas.style.height = cssH + 'px';
    const dpr = Math.min(window.devicePixelRatio || 1, 2);
    canvas.width = Math.round(cssW * dpr);
    canvas.height = Math.round(cssH * dpr);
    ctx.setTransform(dpr,0,0,dpr,0,0);
  }
  window.addEventListener('resize', resize);
  resize();

  // Game variables
  const G = {gravity: 0.55, jump: -9, pipeSpeed: 2.2};
  let state = 'menu'; // menu | start | playing | gameover
  let score = 0, best = +localStorage.getItem('flappy_best')||0;

  const bird = {x:80,y:200,r:14,vy:0,rotation:0};
  let pipes = [], frame = 0;
  const pipeInterval = 95, pipeWidth = 64;

  function reset(){
    bird.y = canvas.height/4;bird.vy=0;bird.rotation=0;
    pipes=[];score=0;frame=0;state='start';
  }
  function spawnPipe(){
    const ch=parseFloat(canvas.style.height);
    const gap=Math.max(110,Math.round(ch*0.18));
    const minTop=40,maxTop=ch-gap-80;
    const top=Math.floor(Math.random()*(maxTop-minTop+1))+minTop;
    pipes.push({x:canvas.width/(window.devicePixelRatio||1)+10,top,gap,width:pipeWidth,passed:false});
  }
  function circleRectCollide(cx,cy,r,rx,ry,rw,rh){
    const closestX=Math.max(rx,Math.min(cx,rx+rw));
    const closestY=Math.max(ry,Math.min(cy,ry+rh));
    const dx=cx-closestX,dy=cy-closestY;return dx*dx+dy*dy<=r*r;
  }

  // ===== Sound system (WebAudio) - offline, lightweight =====
  const AudioEngine = (() => {
    const ctx = new (window.AudioContext || window.webkitAudioContext)();
    let musicNode = null, musicGain=null;
    let enabled = localStorage.getItem('flappy_music_enabled');
    enabled = enabled === null ? true : (enabled === '1');

    function setMusicButton() { musicBtn.textContent = enabled ? 'üîä –ú—É–∑—ã–∫–∞: –í–∫–ª' : 'üîà –ú—É–∑—ã–∫–∞: –í—ã–∫–ª'; }
    setMusicButton();

    // small helper to play short oscillator burst (sfx)
    function playTone(freq, type='sine', time=0.08, gain=0.14) {
      if (!enabled) return;
      try {
        const o = ctx.createOscillator();
        const g = ctx.createGain();
        o.type = type; o.frequency.value = freq;
        g.gain.value = gain;
        o.connect(g); g.connect(ctx.destination);
        const now = ctx.currentTime;
        o.start(now);
        g.gain.setValueAtTime(gain, now);
        g.gain.exponentialRampToValueAtTime(0.001, now + time);
        o.stop(now + time + 0.02);
      } catch (e) { /* silent */ }
    }

    // flap sound ‚Äî short high click
    function flap(){ playTone(880,'square',0.06,0.12); }
    // point sound ‚Äî two quick tones
    function point(){ playTone(1200,'sine',0.06,0.12); setTimeout(()=>playTone(1500,'sine',0.06,0.09),70); }
    // hit sound ‚Äî low damped buzz
    function hit(){ playTone(180,'sawtooth',0.18,0.18); }

    // simple looped background "music" created from oscillators and periodic notes
    function startMusic(){
      if (musicNode) return; // already playing
      if (!enabled) return;
      musicGain = ctx.createGain(); musicGain.gain.value = 0.08; musicGain.connect(ctx.destination);
      // create a small repeated melodic pattern using BufferSource
      const len = 2; // seconds
      const sampleRate = ctx.sampleRate;
      const buffer = ctx.createBuffer(1, sampleRate * len, sampleRate);
      const data = buffer.getChannelData(0);
      // fill buffer with a gentle arpeggio-like pattern
      for (let i=0;i<data.length;i++){
        const t = i / sampleRate;
        // three sine components to make it richer
        data[i] = 0.12*Math.sin(2*Math.PI*220*t)*(1+0.5*Math.sin(2*Math.PI*1.5*t))
                + 0.06*Math.sin(2*Math.PI*440*t)*Math.sin(2*Math.PI*0.25*t)
                + 0.03*Math.sin(2*Math.PI*660*t)*Math.sin(2*Math.PI*0.5*t);
      }
      musicNode = ctx.createBufferSource();
      musicNode.buffer = buffer; musicNode.loop = true; musicNode.connect(musicGain); musicNode.start(0);
    }
    function stopMusic(){ if (musicNode){ musicNode.stop(); musicNode.disconnect(); musicNode = null; } }

    function toggle() { enabled = !enabled; localStorage.setItem('flappy_music_enabled', enabled ? '1' : '0'); setMusicButton(); if(enabled) startMusic(); else stopMusic(); }
    // start music automatically if enabled
    if (enabled) startMusic();

    return {flap,point,hit,toggle,ctx,isEnabled:()=>enabled,setMusicButton};
  })();

  // ===== Game logic =====
  function update(){
    frame++;
    if(state==='playing'){
      bird.vy+=G.gravity;bird.y+=bird.vy;
      bird.rotation=Math.max(Math.min(bird.vy*3,45),-45);
      for(let p of pipes){p.x-=G.pipeSpeed; if(!p.passed && p.x + p.width < bird.x - bird.r){ p.passed = true; score++; AudioEngine.point(); if(score>best){best=score;localStorage.setItem('flappy_best',best);} }}
      pipes = pipes.filter(p=>p.x + p.width > -20);
      if(frame%pipeInterval===0) spawnPipe();
      const ch = canvas.height/(window.devicePixelRatio||1);
      if(bird.y+bird.r>=ch-12 || bird.y-bird.r<=0) { state='gameover'; AudioEngine.hit(); }
      for(let p of pipes){ if(circleRectCollide(bird.x,bird.y,bird.r,p.x,0,p.width,p.top) || circleRectCollide(bird.x,bird.y,bird.r,p.x,p.top+p.gap,p.width,ch-(p.top+p.gap))){ state='gameover'; AudioEngine.hit(); } }
    } else if(state==='start'){
      bird.vy = Math.sin(frame/10)*0.7; bird.y += bird.vy; bird.rotation = Math.sin(frame/10)*6;
      if(frame%pipeInterval===0) spawnPipe(); for(let p of pipes) p.x -= G.pipeSpeed/2; pipes = pipes.filter(p=>p.x+p.width>-20);
    }
  }
  function draw(){
    const w = canvas.width/(window.devicePixelRatio||1), h = canvas.height/(window.devicePixelRatio||1);
    ctx.clearRect(0,0,w,h); ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--bg'); ctx.fillRect(0,0,w,h);
    for(let p of pipes){ ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--pipe'); ctx.fillRect(p.x,0,p.width,p.top); ctx.fillRect(p.x,p.top+p.gap,p.width,h-(p.top+p.gap)); ctx.fillStyle='#1f8a3a'; ctx.fillRect(p.x,p.top-8,p.width,8); ctx.fillRect(p.x,p.top+p.gap,p.width,8); }
    ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--ground'); ctx.fillRect(0,h-12,w,12);
    ctx.save(); ctx.translate(bird.x,bird.y); ctx.rotate(bird.rotation*Math.PI/180);
    ctx.beginPath(); ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--bird'); ctx.arc(0,0,bird.r,0,Math.PI*2); ctx.fill(); ctx.beginPath(); ctx.ellipse(-2,2,8,5,Math.PI/6,0,Math.PI*2); ctx.fillStyle='#f0c94a'; ctx.fill(); ctx.beginPath(); ctx.fillStyle='#222'; ctx.arc(6,-4,3,0,Math.PI*2); ctx.fill(); ctx.beginPath(); ctx.fillStyle='#ff8b2b'; ctx.moveTo(bird.r,-3); ctx.lineTo(bird.r+12,0); ctx.lineTo(bird.r,6); ctx.closePath(); ctx.fill(); ctx.restore();
    ctx.fillStyle='#073642'; ctx.font='bold 34px system-ui,Arial'; ctx.textAlign='center'; ctx.fillText(score,w/2,60);
    ctx.fillStyle='rgba(5,10,15,0.85)'; ctx.font='16px system-ui,Arial';
    if(state==='start') ctx.fillText('–ù–∞–∂–º–∏—Ç–µ –ø—Ä–æ–±–µ–ª –∏–ª–∏ —Ç–∞–ø–Ω–∏—Ç–µ, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å', w/2, h/2 - 20);
    if(state==='gameover'){ ctx.fillStyle='rgba(0,0,0,0.75)'; ctx.font='26px system-ui,Arial'; ctx.fillText('–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞', w/2, h/2 - 10); ctx.font='16px system-ui,Arial'; ctx.fillText('–ù–∞–∂–º–∏—Ç–µ –ø—Ä–æ–±–µ–ª –∏–ª–∏ —Ç–∞–ø–Ω–∏—Ç–µ, —á—Ç–æ–±—ã –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å', w/2, h/2 + 20); ctx.fillText('–í–∞—à —Å—á—ë—Ç: '+score+' | –†–µ–∫–æ—Ä–¥: '+best, w/2, h/2 + 46); }
  }
  function loop(){ update(); draw(); requestAnimationFrame(loop); }

  function flap(){ bird.vy = G.jump; if(state==='start'){ state='playing'; pipes=[]; frame=0; score=0; } if(state==='gameover'){ reset(); } AudioEngine.flap(); }

  // input
  window.addEventListener('keydown', (e) => { if (e.code === 'Space') { e.preventDefault(); flap(); } if (e.key === 'r' || e.key === 'R') reset(); });
  canvas.addEventListener('mousedown', (e) => { e.preventDefault(); if (state === 'gameover') reset(); else flap(); });
  canvas.addEventListener('touchstart', (e) => { e.preventDefault(); if (state === 'gameover') reset(); else flap(); }, {passive:false});

  // UI buttons
  startBtn.onclick = ()=>{ menu.classList.add('hide'); state='start'; };
  helpBtn.onclick = ()=>{ alert('–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:\n‚Ä¢ –ü—Ä–æ–±–µ–ª –∏–ª–∏ —Ç–∞–ø ‚Äî –≤–∑–º–∞—Ö\n‚Ä¢ –ù–µ –≤—Ä–µ–∑–∞–π—Ç–µ—Å—å –≤ —Ç—Ä—É–±—ã\n‚Ä¢ R ‚Äî –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫'); };
  recordsBtn.onclick = ()=>{ alert('–í–∞—à —Ä–µ–∫–æ—Ä–¥: '+best); };
  musicBtn.onclick = ()=>{ AudioEngine.toggle(); };

  // initialize
  reset(); loop();
})();
</script></body>
</html>


